



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Dealing With Sensitive Data - Delphix Virtualization SDK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.fbb7f3af.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Helvetica+Neue:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Helvetica Neue","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#dealing-with-sensitive-data" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Delphix Virtualization SDK" class="md-header-nav__button md-logo">
          
            <img src="../../images/delphix-logo-white.png" width="153" height="15">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Delphix Virtualization SDK
              </span>
              <span class="md-header-nav__topic">
                Dealing With Sensitive Data
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/delphix-logo-white.png" width="48" height="48">
      
    </span>
    Delphix Virtualization SDK
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome!" class="md-nav__link">
      Welcome!
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Getting_Started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Your First Plugin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Your First Plugin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Your_First_Plugin/Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Your_First_Plugin/Discovery/" title="Discovery" class="md-nav__link">
      Discovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Your_First_Plugin/Data_Ingestion/" title="Data Ingestion" class="md-nav__link">
      Data Ingestion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Your_First_Plugin/Provisioning/" title="Provisioning" class="md-nav__link">
      Provisioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Decorators/" title="Decorators" class="md-nav__link">
      Decorators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Plugin_Operations/" title="Plugin Operations" class="md-nav__link">
      Plugin Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Workflows/" title="Workflows" class="md-nav__link">
      Workflows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Classes/" title="Classes" class="md-nav__link">
      Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Schemas/" title="Schemas" class="md-nav__link">
      Schemas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Schemas_and_Autogenerated_Classes/" title="Schemas and Autogenerated Classes" class="md-nav__link">
      Schemas and Autogenerated Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/CLI/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Plugin_Versioning/" title="Plugin Versioning" class="md-nav__link">
      Plugin Versioning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Best Practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Best Practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Dealing With Sensitive Data" class="md-nav__link md-nav__link--active">
      Dealing With Sensitive Data
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="dealing-with-sensitive-data">Dealing With Sensitive Data<a class="headerlink" href="#dealing-with-sensitive-data" title="Permanent link">&para;</a></h1>
<p>Often, a plugin will need to handle sensitive user-provided data. The most common example of this is a database password.</p>
<p>Plugins must be careful to handle such sensitive data appropriately. Three tips for handling such data are:</p>
<ol>
<li>Tell the Delphix Engine which parts of your data are sensitive.</li>
<li>When passing sensitive data to remote callbacks (such as <code>RunBash</code>), use environment variables.</li>
<li>Avoid logging, or otherwise writing out the sensitive data.</li>
</ol>
<p>Each of these tips are explained below.</p>
<h1 id="marking-your-data-as-sensitive">Marking Your Data As Sensitive<a class="headerlink" href="#marking-your-data-as-sensitive" title="Permanent link">&para;</a></h1>
<p>Because the Delphix Engine mangages the storing and retreiving of plugin-defined data, it needs to know which pieces of data are sensitive. The plugin does this in its <a href="../../References/Glossary/#schema">schemas</a>, by using the special <a href="../../References/Schemas/#password"><code>password</code></a> keyword.</p>
<p>Here is an example of a schema that defines an object with three properties, one of which is sensitive and tagged with the <code>password</code> keyword:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;db_connectionPort&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
        <span class="nt">&quot;db_username&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
        <span class="nt">&quot;db_password&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nt">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This tells the Delphix Engine to take special precautions with this password property, as follows:</p>
<ol>
<li>The Delphix Engine will encrypt the password before storing it, and decrypt it only as necessary to pass pack to the plugin.</li>
<li>The Delphix Engine will not write this password anywhere (for example, it will not appear in any system logs)</li>
<li>The Delphix Engine's UI and CLI will not display the password.</li>
<li>No clients of the Delphix Engine's public API will be able to access the password.</li>
</ol>
<h1 id="using-environment-variables-for-remote-data-passing">Using Environment Variables For Remote Data Passing<a class="headerlink" href="#using-environment-variables-for-remote-data-passing" title="Permanent link">&para;</a></h1>
<p>Sometimes, a plugin will need to pass sensitive data to a remote environment. For example, perhaps a database command needs to be run on a <a href="../../References/Glossary/#staging-environment">staging environment</a>, and that database command will need to use a password.</p>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h2>
<p>Let's take a look at a very simple example. Let's suppose we need to shutdown a database called "inventory" on a target environment. Further, suppose that the command to do so is <code>db_cmd shutdown inventory</code>. Finally, suppose that command will ask for a password on <code>stdin</code>, and that our password is "hunter2".</p>
<p>If we were running this command by hand, it might look like this:</p>
<div class="codehilite"><pre><span></span>$ db_cmd shutdown inventory
Connecting to database instance...
Please enter database password:
</pre></div>


<p>At this point, we'd type in "hunter2", and the command would proceed to shut down the database.</p>
<p>Since a plugin cannot type in the password by hand, it will have to do something like this instead:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">&quot;hunter2&quot;</span> <span class="p">|</span> db_cmd shutdown inventory
</pre></div>


<h2 id="dont-do-this">Don't Do This<a class="headerlink" href="#dont-do-this" title="Permanent link">&para;</a></h2>
<p>First, let's take a look at how <strong>not</strong> to do this! Here is a bit of plugin python code that will run the above command.</p>
<div class="codehilite"><pre><span></span><span class="c1"># THIS IS INSECURE! DO NOT DO THIS!</span>
<span class="n">full_command</span> <span class="o">=</span> <span class="s2">&quot;echo {} | db_cmd shutdown {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>
<span class="n">dlpx</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">env</span> <span class="o">=</span> <span class="n">target_env</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">full_command</span><span class="p">,</span> <span class="n">user</span> <span class="o">=</span> <span class="n">target_user</span><span class="p">)</span>
</pre></div>


<p>This will construct a Python string containing exactly the desired command from above. However, this is not recommended.</p>
<p>The problem here is that there is a cleartext password in the Python string. But, this Python string is not treated as sensitive by the Delphix Engine. For example, suppose the Delphix Engine cannot make a connection to the target environment. In that case, it will raise an error containing the Python string, so that people will know what command failed. But, in our example, that would result in the password being part of the cleartext error message!</p>
<h2 id="using-environment-variables">Using Environment Variables<a class="headerlink" href="#using-environment-variables" title="Permanent link">&para;</a></h2>
<p>The Delphix Engine provides a better way to pass sensitive data to remote bash (or powershell) calls: environment variables. Let's look at a different way to run the same command as above.</p>
<div class="codehilite"><pre><span></span><span class="c1"># Use environment variables to pass sensitive data to remote commands</span>
<span class="n">environment_vars</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;DATABASE_PASSWORD&quot;</span> <span class="p">:</span> <span class="n">password</span>
<span class="p">}</span>
<span class="n">full_command</span> <span class="o">=</span> <span class="s2">&quot;echo $DATABASE_PASSWORD | db_cmd shutdown {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<span class="n">dlpx</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">env</span> <span class="o">=</span> <span class="n">target_env</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">full_command</span><span class="p">,</span> <span class="n">user</span> <span class="o">=</span> <span class="n">target_user</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="n">environment_vars</span><span class="p">)</span>
</pre></div>


<p>Note that we are no longer putting the cleartext password into the Python command string. Instead, we are instructing the Delphix Engine to put the password into an environment variable on the target environment. The Python command string merely mentions the name of the environment variable, and does not contain the password itself.</p>
<p>Once the command runs on the target environment, Bash will substitute in the password, and the database shutdown will run as expected.</p>
<p>Unlike with the command string, the Delphix Engine <strong>does</strong> treat environment variables as sensitive information, and will not include them in error messages or internal logs, etc.</p>
<h1 id="dont-write-out-sensitive-data">Don't Write Out Sensitive Data<a class="headerlink" href="#dont-write-out-sensitive-data" title="Permanent link">&para;</a></h1>
<p>Plugin writers are strongly advised to never write out unencrypted sensitive data. This is common-sense general advice that applies to all areas of programming, not just for plugins. However, there are a couple of special concerns for plugins.</p>
<p>The Delphix Engine provides logging capabilities to plugins. The generated logs are unencrypted and not treated as sensitive. Therefore, it is important for plugins to <strong>never log sensitive data</strong>.</p>
<p>In addition, remember that your plugin itself is not treated as sensitive by the Delphix Engine. Plugin code is distributed unencrypted, and is viewable in cleartext by users of the Delphix Engine. So, you should not hard-code anything sensitive, like passwords, in your plugin code.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../References/Logging/" title="Logging" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Logging
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Delphix Corp.
          </div>
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://www.delphix.com/" class="md-footer-social__link fa fa-sitemap"></a>
    
      <a href="https://www.facebook.com/DelphixCorp/" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://twitter.com/delphix" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/delphix" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://github.com/delphix" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.878fdd8d.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-35429885-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>