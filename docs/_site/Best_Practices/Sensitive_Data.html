<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Dealing With Sensitive Data | virtualization-sdk</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Dealing With Sensitive Data" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/Best_Practices/Sensitive_Data.html" />
<meta property="og:url" content="http://localhost:4000/Best_Practices/Sensitive_Data.html" />
<meta property="og:site_name" content="virtualization-sdk" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/Best_Practices/Sensitive_Data.html","headline":"Dealing With Sensitive Data","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=52f3c2ef1003e9fe35bc8813a5d4baa843da74c1">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">virtualization-sdk</a></h1>
      

      <h1 id="dealing-with-sensitive-data">Dealing With Sensitive Data</h1>

<p>Often, a plugin will need to handle sensitive user-provided data. The most common example of this is a database password.</p>

<p>Plugins must be careful to handle sensitive data appropriately. Three tips for handling sensitive data are:</p>

<ol>
  <li>Tell the Delphix Engine which parts of your data are sensitive.</li>
  <li>When passing sensitive data to remote plugin library functions (such as <code class="highlighter-rouge">run_bash</code>), use environment variables.</li>
  <li>Avoid logging, or otherwise writing out the sensitive data.</li>
</ol>

<p>Each of these tips are explained below.</p>

<h1 id="marking-your-data-as-sensitive">Marking Your Data As Sensitive</h1>

<p>Because the Delphix Engine manages the storing and retrieving of plugin-defined data, it needs to know which pieces of data are sensitive. The plugin does this in its <a href="/References/Glossary.md#schema">schemas</a>, by using the special <a href="/References/Schemas.md#password"><code class="highlighter-rouge">password</code></a> keyword.</p>

<p>The following example of a schema defines an object with three properties, one of which is sensitive and tagged with the <code class="highlighter-rouge">password</code> keyword:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"db_connectionPort"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
        </span><span class="s2">"db_username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
        </span><span class="s2">"db_password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This tells the Delphix Engine to take special precautions with this password property, as follows:</p>

<ol>
  <li>The Delphix Engine will encrypt the password before storing it, and decrypt it only as necessary to pass back to the plugin.</li>
  <li>The Delphix Engine will not write this password anywhere (for example, it will not appear in any system logs).</li>
  <li>The Delphix Engine’s UI and CLI will not display the password.</li>
  <li>Clients of the Delphix Engine’s public API will not be able to access the password.</li>
</ol>

<h1 id="using-environment-variables-for-remote-data-passing">Using Environment Variables For Remote Data Passing</h1>

<p>Sometimes, a plugin will need to pass sensitive data to a remote environment. For example, perhaps a database command needs to be run on a <a href="/References/Glossary.md#staging-environment">staging environment</a>, and that database command will need to use a password.</p>

<h2 id="example">Example</h2>
<p>Let us take a look at a very simple example where we need to shutdown a database called “inventory” on a target environment by using the <code class="highlighter-rouge">db_cmd shutdown inventory</code> command. This command will ask for a password on <code class="highlighter-rouge">stdin</code>, and for our example our password is “hunter2”.</p>

<p>If we were running this command by hand, it might look like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>db_cmd shutdown inventory
Connecting to database instance...
Please enter database password:
</code></pre></div></div>

<p>At this point, we would type in “hunter2”, and the command would proceed to shut down the database.</p>

<p>Since a plugin cannot type in the password by hand, it will do something like this instead:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"hunter2"</span> | db_cmd shutdown inventory
</code></pre></div></div>

<h2 id="dont-do-this">Don’t Do This</h2>

<p>First, let us take a look at how <strong>not</strong> to do this! Here is a bit of plugin python code that will run the above command.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">dlpx.virtualization</span> <span class="kn">import</span> <span class="n">libs</span>
<span class="kn">from</span> <span class="nn">dlpx.virtualization.platform</span> <span class="kn">import</span> <span class="n">Plugin</span>

<span class="n">plugin</span> <span class="o">=</span> <span class="n">Plugin</span><span class="p">()</span>

<span class="nd">@plugin.virtual.stop</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_virtual_stop</span><span class="p">(</span><span class="n">virtual_source</span><span class="p">,</span> <span class="n">repository</span><span class="p">,</span> <span class="n">source_config</span><span class="p">):</span>
  <span class="c"># THIS IS INSECURE! DO NOT DO THIS!</span>
  <span class="n">full_command</span> <span class="o">=</span> <span class="s">"echo {} | db_cmd shutdown {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>
  <span class="n">libs</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">virtual_source</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">full_command</span><span class="p">)</span>
</code></pre></div></div>

<p>This constructs a Python string containing exactly the desired command from above. However, this is not recommended.</p>

<p>The problem here is that there is a cleartext password in the Python string. But, this Python string is not treated as sensitive by the Virtualization Platform. For example, suppose the Virtualization Platform cannot make a connection to the target environment. In which case, it will raise an error containing the Python string, so that people will know what command failed. But, in our example, that would result in the password being part of the cleartext error message.</p>

<h2 id="using-environment-variables">Using Environment Variables</h2>

<p>The Delphix Engine provides a better way to pass sensitive data to remote bash (or powershell) calls: environment variables. Let us look at a different way to run the same command as above.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">dlpx.virtualization</span> <span class="kn">import</span> <span class="n">libs</span>
<span class="kn">from</span> <span class="nn">dlpx.virtualization.platform</span> <span class="kn">import</span> <span class="n">Plugin</span>

<span class="n">plugin</span> <span class="o">=</span> <span class="n">Plugin</span><span class="p">()</span>

<span class="nd">@plugin.virtual.stop</span><span class="p">()</span>
  <span class="c"># Use environment variables to pass sensitive data to remote commands</span>
  <span class="n">environment_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"DATABASE_PASSWORD"</span> <span class="p">:</span> <span class="n">password</span>
  <span class="p">}</span>
  <span class="n">full_command</span> <span class="o">=</span> <span class="s">"echo $DATABASE_PASSWORD | db_cmd shutdown {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
  <span class="n">libs</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">virtual_source</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">full_command</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">environment_vars</span><span class="p">)</span>
</code></pre></div></div>

<p>!!! note
	We are no longer putting the cleartext password into the Python command string. Instead, we are instructing the Virtualization Platform to put the password into an environment variable on the target environment. The Python command string merely mentions the name of the environment variable, and does not contain the password itself.</p>

<p>Once the command runs on the target environment, Bash will substitute in the password, and the database shutdown will run as expected.</p>

<p>Unlike with the command string, the Virtualization Platform <strong>does</strong> treat environment variables as sensitive information, and will not include them in error messages or internal logs, etc.</p>

<h1 id="dont-write-out-sensitive-data">Don’t Write Out Sensitive Data</h1>

<p>Plugin writers are strongly advised to never write out unencrypted sensitive data. This is common-sense general advice that applies to all areas of programming, not just for plugins. However, there are a couple of special concerns for plugins.</p>

<p>The Virtualization Platform provides logging capabilities to plugins. The generated logs are unencrypted and not treated as sensitive. Therefore, it is important for plugins to <strong>never log sensitive data</strong>.</p>

<p>In addition, remember that your plugin is not treated as sensitive by the Virtualization Platform. Plugin code is distributed unencrypted, and is viewable in cleartext by Delphix Engine users. Sensitive data such as passwords should never be hard-coded in your plugin code.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
